import sys.io.File;
import haxe.io.Eof;
class Gui2Cterm
{

	static var lookup = [
		{ i:16, r:0x00, g:0x00, b:0x00 },
		{ i:17, r:0x00, g:0x00, b:0x5f },
		{ i:18, r:0x00, g:0x00, b:0x87 },
		{ i:19, r:0x00, g:0x00, b:0xaf },
		{ i:20, r:0x00, g:0x00, b:0xd7 },
		{ i:21, r:0x00, g:0x00, b:0xff },
		{ i:22, r:0x00, g:0x5f, b:0x00 },
		{ i:23, r:0x00, g:0x5f, b:0x5f },
		{ i:24, r:0x00, g:0x5f, b:0x87 },
		{ i:25, r:0x00, g:0x5f, b:0xaf },
		{ i:26, r:0x00, g:0x5f, b:0xd7 },
		{ i:27, r:0x00, g:0x5f, b:0xff },
		{ i:28, r:0x00, g:0x87, b:0x00 },
		{ i:29, r:0x00, g:0x87, b:0x5f },
		{ i:30, r:0x00, g:0x87, b:0x87 },
		{ i:31, r:0x00, g:0x87, b:0xaf },
		{ i:32, r:0x00, g:0x87, b:0xd7 },
		{ i:33, r:0x00, g:0x87, b:0xff },
		{ i:34, r:0x00, g:0xaf, b:0x00 },
		{ i:35, r:0x00, g:0xaf, b:0x5f },
		{ i:36, r:0x00, g:0xaf, b:0x87 },
		{ i:37, r:0x00, g:0xaf, b:0xaf },
		{ i:38, r:0x00, g:0xaf, b:0xd7 },
		{ i:39, r:0x00, g:0xaf, b:0xff },
		{ i:40, r:0x00, g:0xd7, b:0x00 },
		{ i:41, r:0x00, g:0xd7, b:0x5f },
		{ i:42, r:0x00, g:0xd7, b:0x87 },
		{ i:43, r:0x00, g:0xd7, b:0xaf },
		{ i:44, r:0x00, g:0xd7, b:0xd7 },
		{ i:45, r:0x00, g:0xd7, b:0xff },
		{ i:46, r:0x00, g:0xff, b:0x00 },
		{ i:47, r:0x00, g:0xff, b:0x5f },
		{ i:48, r:0x00, g:0xff, b:0x87 },
		{ i:49, r:0x00, g:0xff, b:0xaf },
		{ i:50, r:0x00, g:0xff, b:0xd7 },
		{ i:51, r:0x00, g:0xff, b:0xff },
		{ i:52, r:0x5f, g:0x00, b:0x00 },
		{ i:53, r:0x5f, g:0x00, b:0x5f },
		{ i:54, r:0x5f, g:0x00, b:0x87 },
		{ i:55, r:0x5f, g:0x00, b:0xaf },
		{ i:56, r:0x5f, g:0x00, b:0xd7 },
		{ i:57, r:0x5f, g:0x00, b:0xff },
		{ i:58, r:0x5f, g:0x5f, b:0x00 },
		{ i:59, r:0x5f, g:0x5f, b:0x5f },
		{ i:60, r:0x5f, g:0x5f, b:0x87 },
		{ i:61, r:0x5f, g:0x5f, b:0xaf },
		{ i:62, r:0x5f, g:0x5f, b:0xd7 },
		{ i:63, r:0x5f, g:0x5f, b:0xff },
		{ i:64, r:0x5f, g:0x87, b:0x00 },
		{ i:65, r:0x5f, g:0x87, b:0x5f },
		{ i:66, r:0x5f, g:0x87, b:0x87 },
		{ i:67, r:0x5f, g:0x87, b:0xaf },
		{ i:68, r:0x5f, g:0x87, b:0xd7 },
		{ i:69, r:0x5f, g:0x87, b:0xff },
		{ i:70, r:0x5f, g:0xaf, b:0x00 },
		{ i:71, r:0x5f, g:0xaf, b:0x5f },
		{ i:72, r:0x5f, g:0xaf, b:0x87 },
		{ i:73, r:0x5f, g:0xaf, b:0xaf },
		{ i:74, r:0x5f, g:0xaf, b:0xd7 },
		{ i:75, r:0x5f, g:0xaf, b:0xff },
		{ i:76, r:0x5f, g:0xd7, b:0x00 },
		{ i:77, r:0x5f, g:0xd7, b:0x5f },
		{ i:78, r:0x5f, g:0xd7, b:0x87 },
		{ i:79, r:0x5f, g:0xd7, b:0xaf },
		{ i:80, r:0x5f, g:0xd7, b:0xd7 },
		{ i:81, r:0x5f, g:0xd7, b:0xff },
		{ i:82, r:0x5f, g:0xff, b:0x00 },
		{ i:83, r:0x5f, g:0xff, b:0x5f },
		{ i:84, r:0x5f, g:0xff, b:0x87 },
		{ i:85, r:0x5f, g:0xff, b:0xaf },
		{ i:86, r:0x5f, g:0xff, b:0xd7 },
		{ i:87, r:0x5f, g:0xff, b:0xff },
		{ i:88, r:0x87, g:0x00, b:0x00 },
		{ i:89, r:0x87, g:0x00, b:0x5f },
		{ i:90, r:0x87, g:0x00, b:0x87 },
		{ i:91, r:0x87, g:0x00, b:0xaf },
		{ i:92, r:0x87, g:0x00, b:0xd7 },
		{ i:93, r:0x87, g:0x00, b:0xff },
		{ i:94, r:0x87, g:0x5f, b:0x00 },
		{ i:95, r:0x87, g:0x5f, b:0x5f },
		{ i:96, r:0x87, g:0x5f, b:0x87 },
		{ i:97, r:0x87, g:0x5f, b:0xaf },
		{ i:98, r:0x87, g:0x5f, b:0xd7 },
		{ i:99, r:0x87, g:0x5f, b:0xff },
		{ i:100, r:0x87, g:0x87, b:0x00 },
		{ i:101, r:0x87, g:0x87, b:0x5f },
		{ i:102, r:0x87, g:0x87, b:0x87 },
		{ i:103, r:0x87, g:0x87, b:0xaf },
		{ i:104, r:0x87, g:0x87, b:0xd7 },
		{ i:105, r:0x87, g:0x87, b:0xff },
		{ i:106, r:0x87, g:0xaf, b:0x00 },
		{ i:107, r:0x87, g:0xaf, b:0x5f },
		{ i:108, r:0x87, g:0xaf, b:0x87 },
		{ i:109, r:0x87, g:0xaf, b:0xaf },
		{ i:110, r:0x87, g:0xaf, b:0xd7 },
		{ i:111, r:0x87, g:0xaf, b:0xff },
		{ i:112, r:0x87, g:0xd7, b:0x00 },
		{ i:113, r:0x87, g:0xd7, b:0x5f },
		{ i:114, r:0x87, g:0xd7, b:0x87 },
		{ i:115, r:0x87, g:0xd7, b:0xaf },
		{ i:116, r:0x87, g:0xd7, b:0xd7 },
		{ i:117, r:0x87, g:0xd7, b:0xff },
		{ i:118, r:0x87, g:0xff, b:0x00 },
		{ i:119, r:0x87, g:0xff, b:0x5f },
		{ i:120, r:0x87, g:0xff, b:0x87 },
		{ i:121, r:0x87, g:0xff, b:0xaf },
		{ i:122, r:0x87, g:0xff, b:0xd7 },
		{ i:123, r:0x87, g:0xff, b:0xff },
		{ i:124, r:0xaf, g:0x00, b:0x00 },
		{ i:125, r:0xaf, g:0x00, b:0x5f },
		{ i:126, r:0xaf, g:0x00, b:0x87 },
		{ i:127, r:0xaf, g:0x00, b:0xaf },
		{ i:128, r:0xaf, g:0x00, b:0xd7 },
		{ i:129, r:0xaf, g:0x00, b:0xff },
		{ i:130, r:0xaf, g:0x5f, b:0x00 },
		{ i:131, r:0xaf, g:0x5f, b:0x5f },
		{ i:132, r:0xaf, g:0x5f, b:0x87 },
		{ i:133, r:0xaf, g:0x5f, b:0xaf },
		{ i:134, r:0xaf, g:0x5f, b:0xd7 },
		{ i:135, r:0xaf, g:0x5f, b:0xff },
		{ i:136, r:0xaf, g:0x87, b:0x00 },
		{ i:137, r:0xaf, g:0x87, b:0x5f },
		{ i:138, r:0xaf, g:0x87, b:0x87 },
		{ i:139, r:0xaf, g:0x87, b:0xaf },
		{ i:140, r:0xaf, g:0x87, b:0xd7 },
		{ i:141, r:0xaf, g:0x87, b:0xff },
		{ i:142, r:0xaf, g:0xaf, b:0x00 },
		{ i:143, r:0xaf, g:0xaf, b:0x5f },
		{ i:144, r:0xaf, g:0xaf, b:0x87 },
		{ i:145, r:0xaf, g:0xaf, b:0xaf },
		{ i:146, r:0xaf, g:0xaf, b:0xd7 },
		{ i:147, r:0xaf, g:0xaf, b:0xff },
		{ i:148, r:0xaf, g:0xd7, b:0x00 },
		{ i:149, r:0xaf, g:0xd7, b:0x5f },
		{ i:150, r:0xaf, g:0xd7, b:0x87 },
		{ i:151, r:0xaf, g:0xd7, b:0xaf },
		{ i:152, r:0xaf, g:0xd7, b:0xd7 },
		{ i:153, r:0xaf, g:0xd7, b:0xff },
		{ i:154, r:0xaf, g:0xff, b:0x00 },
		{ i:155, r:0xaf, g:0xff, b:0x5f },
		{ i:156, r:0xaf, g:0xff, b:0x87 },
		{ i:157, r:0xaf, g:0xff, b:0xaf },
		{ i:158, r:0xaf, g:0xff, b:0xd7 },
		{ i:159, r:0xaf, g:0xff, b:0xff },
		{ i:160, r:0xd7, g:0x00, b:0x00 },
		{ i:161, r:0xd7, g:0x00, b:0x5f },
		{ i:162, r:0xd7, g:0x00, b:0x87 },
		{ i:163, r:0xd7, g:0x00, b:0xaf },
		{ i:164, r:0xd7, g:0x00, b:0xd7 },
		{ i:165, r:0xd7, g:0x00, b:0xff },
		{ i:166, r:0xd7, g:0x5f, b:0x00 },
		{ i:167, r:0xd7, g:0x5f, b:0x5f },
		{ i:168, r:0xd7, g:0x5f, b:0x87 },
		{ i:169, r:0xd7, g:0x5f, b:0xaf },
		{ i:170, r:0xd7, g:0x5f, b:0xd7 },
		{ i:171, r:0xd7, g:0x5f, b:0xff },
		{ i:172, r:0xd7, g:0x87, b:0x00 },
		{ i:173, r:0xd7, g:0x87, b:0x5f },
		{ i:174, r:0xd7, g:0x87, b:0x87 },
		{ i:175, r:0xd7, g:0x87, b:0xaf },
		{ i:176, r:0xd7, g:0x87, b:0xd7 },
		{ i:177, r:0xd7, g:0x87, b:0xff },
		{ i:178, r:0xd7, g:0xaf, b:0x00 },
		{ i:179, r:0xd7, g:0xaf, b:0x5f },
		{ i:180, r:0xd7, g:0xaf, b:0x87 },
		{ i:181, r:0xd7, g:0xaf, b:0xaf },
		{ i:182, r:0xd7, g:0xaf, b:0xd7 },
		{ i:183, r:0xd7, g:0xaf, b:0xff },
		{ i:184, r:0xd7, g:0xd7, b:0x00 },
		{ i:185, r:0xd7, g:0xd7, b:0x5f },
		{ i:186, r:0xd7, g:0xd7, b:0x87 },
		{ i:187, r:0xd7, g:0xd7, b:0xaf },
		{ i:188, r:0xd7, g:0xd7, b:0xd7 },
		{ i:189, r:0xd7, g:0xd7, b:0xff },
		{ i:190, r:0xd7, g:0xff, b:0x00 },
		{ i:191, r:0xd7, g:0xff, b:0x5f },
		{ i:192, r:0xd7, g:0xff, b:0x87 },
		{ i:193, r:0xd7, g:0xff, b:0xaf },
		{ i:194, r:0xd7, g:0xff, b:0xd7 },
		{ i:195, r:0xd7, g:0xff, b:0xff },
		{ i:196, r:0xff, g:0x00, b:0x00 },
		{ i:197, r:0xff, g:0x00, b:0x5f },
		{ i:198, r:0xff, g:0x00, b:0x87 },
		{ i:199, r:0xff, g:0x00, b:0xaf },
		{ i:200, r:0xff, g:0x00, b:0xd7 },
		{ i:201, r:0xff, g:0x00, b:0xff },
		{ i:202, r:0xff, g:0x5f, b:0x00 },
		{ i:203, r:0xff, g:0x5f, b:0x5f },
		{ i:204, r:0xff, g:0x5f, b:0x87 },
		{ i:205, r:0xff, g:0x5f, b:0xaf },
		{ i:206, r:0xff, g:0x5f, b:0xd7 },
		{ i:207, r:0xff, g:0x5f, b:0xff },
		{ i:208, r:0xff, g:0x87, b:0x00 },
		{ i:209, r:0xff, g:0x87, b:0x5f },
		{ i:210, r:0xff, g:0x87, b:0x87 },
		{ i:211, r:0xff, g:0x87, b:0xaf },
		{ i:212, r:0xff, g:0x87, b:0xd7 },
		{ i:213, r:0xff, g:0x87, b:0xff },
		{ i:214, r:0xff, g:0xaf, b:0x00 },
		{ i:215, r:0xff, g:0xaf, b:0x5f },
		{ i:216, r:0xff, g:0xaf, b:0x87 },
		{ i:217, r:0xff, g:0xaf, b:0xaf },
		{ i:218, r:0xff, g:0xaf, b:0xd7 },
		{ i:219, r:0xff, g:0xaf, b:0xff },
		{ i:220, r:0xff, g:0xd7, b:0x00 },
		{ i:221, r:0xff, g:0xd7, b:0x5f },
		{ i:222, r:0xff, g:0xd7, b:0x87 },
		{ i:223, r:0xff, g:0xd7, b:0xaf },
		{ i:224, r:0xff, g:0xd7, b:0xd7 },
		{ i:225, r:0xff, g:0xd7, b:0xff },
		{ i:226, r:0xff, g:0xff, b:0x00 },
		{ i:227, r:0xff, g:0xff, b:0x5f },
		{ i:228, r:0xff, g:0xff, b:0x87 },
		{ i:229, r:0xff, g:0xff, b:0xaf },
		{ i:230, r:0xff, g:0xff, b:0xd7 },
		{ i:231, r:0xff, g:0xff, b:0xff },
		{ i:232, r:0x08, g:0x08, b:0x08 },
		{ i:233, r:0x12, g:0x12, b:0x12 },
		{ i:234, r:0x1c, g:0x1c, b:0x1c },
		{ i:235, r:0x26, g:0x26, b:0x26 },
		{ i:236, r:0x30, g:0x30, b:0x30 },
		{ i:237, r:0x3a, g:0x3a, b:0x3a },
		{ i:238, r:0x44, g:0x44, b:0x44 },
		{ i:239, r:0x4e, g:0x4e, b:0x4e },
		{ i:240, r:0x58, g:0x58, b:0x58 },
		{ i:241, r:0x62, g:0x62, b:0x62 },
		{ i:242, r:0x6c, g:0x6c, b:0x6c },
		{ i:243, r:0x76, g:0x76, b:0x76 },
		{ i:244, r:0x80, g:0x80, b:0x80 },
		{ i:245, r:0x8a, g:0x8a, b:0x8a },
		{ i:246, r:0x94, g:0x94, b:0x94 },
		{ i:247, r:0x9e, g:0x9e, b:0x9e },
		{ i:248, r:0xa8, g:0xa8, b:0xa8 },
		{ i:249, r:0xb2, g:0xb2, b:0xb2 },
		{ i:250, r:0xbc, g:0xbc, b:0xbc },
		{ i:251, r:0xc6, g:0xc6, b:0xc6 },
		{ i:252, r:0xd0, g:0xd0, b:0xd0 },
		{ i:253, r:0xda, g:0xda, b:0xda },
		{ i:254, r:0xe4, g:0xe4, b:0xe4 },
		{ i:255, r:0xee, g:0xee, b:0xee },
	];

	static function convertColor(color:Int)
	{
		var r = (color >> 16) & 0xFF,
				g = (color >> 8) & 0xFF,
				b = (color) & 0xFF;
		// trace(r,g,b);

		//first try exact search
		for (val in lookup)
		{
			if (r == val.r && g == val.g && b == val.b)
				return val.i;
		}

		// try to find a lighter version
		r = Std.int(r * 1.2);
		g = Std.int(g * 1.2);
		b = Std.int(b * 1.2);
		var best = null,
				bestVal = Math.POSITIVE_INFINITY;
		for (val in lookup)
		{
			var dist =
				(val.r - r) * (val.r - r) +
				(val.g - g) * (val.g - g) +
				(val.b - b) * (val.b - b);
			// trace(dist,bestVal,val.r,val.g,val.b);
			if (dist < bestVal)
			{
				best = val;
				bestVal = dist;
			}
		}
		return best.i;
	}

	static function main()
	{
		var file = File.read(Sys.args()[0]);
		var buf = new StringBuf();

		var gui = ~/gui(\w*)=#([0-9A-Fa-f]+)/;
		try
		{
			while(true)
			{
				var ln = file.readLine();
				while (gui.match(ln))
				{
					buf.add(gui.matchedLeft());
					buf.add(gui.matched(0));
					buf.add(' ');
					var type = gui.matched(1),
							color = Std.parseInt('0x' + gui.matched(2));
					if (type == 'fg' || type == 'bg' || type == '')
					{
						buf.add('cterm$type=${convertColor(color)} ');
					}
					ln = gui.matchedRight();
				}
				buf.add(ln);
				buf.add('\n');
			}
		}
		catch(e:Eof) {}

		File.saveContent(Sys.args()[0], buf.toString());
	}

}
